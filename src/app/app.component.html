<mat-drawer-container class="main-container">
  <!-- File Tree Sidebar -->
  <mat-drawer mode="side"
    opened
    class="file-structure">
    <div class="file-tree">
      <!-- Buttons for adding files and folders -->
      <div class="controls">
        <button mat-flat-button
          color="primary"
          class="file-button"
          (click)="addFiles()">Add 50 Files</button>
        <button mat-flat-button
          color="accent"
          class="folder-button"
          (click)="addFolders()">Add 50 Folders</button>
      </div>

      <!-- File tree with proper height and drop zones -->
      <div cdkDropList
        [cdkDropListData]="nodes"
        id="main"
        [cdkDropListConnectedTo]="dropTargetIds"
        (cdkDropListDropped)="drop($event)"
        [cdkDropListSortingDisabled]="true"
        class="cdk-drop-list">
        <div *ngFor="let node of nodes"
          cdkDrag
          [cdkDragData]="node.id"
          (cdkDragMoved)="onDragMoved($event)">
          <ng-container *ngTemplateOutlet="tmplNode; context: { node: node }"></ng-container>
        </div>
      </div>
    </div>
  </mat-drawer>

  <!-- Editor Area -->
  <mat-drawer-content class="editor-area">
    <h2>Code Editor</h2>
  </mat-drawer-content>
</mat-drawer-container>

<!-- Reusable Template for File Tree -->
<ng-template #tmplNode
  let-node="node">
  <div class="node-item"
    [attr.data-id]="node.id"
    [attr.id]="'node-' + node.id">
    <div class="node-title"
      (click)="toggleExpandNode(node); selectNode(node)"
      [ngClass]="{ 'selected': isSelected(node) }">
      <mat-icon>{{ node.children.length ? 'folder' : 'description' }}</mat-icon>
      &nbsp;&nbsp;&nbsp;
      {{ node.id }}
    </div>

    <div *ngIf="node.isExpanded && node.children.length"
      class="node-children"
      cdkDropList
      [cdkDropListData]="node.children"
      [id]="node.id"
      [cdkDropListConnectedTo]="dropTargetIds"
      (cdkDropListDropped)="drop($event)"
      [cdkDropListSortingDisabled]="true">
      <div *ngFor="let child of node.children"
        cdkDrag
        [cdkDragData]="child.id"
        (cdkDragMoved)="onDragMoved($event)">
        <ng-container *ngTemplateOutlet="tmplNode; context: { node: child }"></ng-container>
      </div>
    </div>
  </div>
</ng-template>